<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>FMI Sääkartta</title>
<link rel="stylesheet" href="leaflet.css">
<script src="leaflet.js"></script>
<style>
html,body{margin:0;height:100%}
#map{height:100%;width:100%}
</style>
</head>
<body>
<div id="map"></div>
<script>
var map=L.map('map').setView([64.5,26],5);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

function tempColor(t){
 if(t==null||isNaN(t))return '#999';
 if(t<=-20)return '#08306b';
 if(t<=-10)return '#2171b5';
 if(t<=0)return '#6baed6';
 if(t<=10)return '#fee08b';
 if(t<=20)return '#fdae61';
 return '#d73027';
}

fetch('http://localhost:8002/api/observations')
.then(r=>r.json())
.then(fc=>{
 console.log('OBS FEATURES:',fc.features.length);
 fc.features.forEach(f=>{
  var c=f.geometry.coordinates;
  var p=f.properties;
  L.circleMarker([c[1],c[0]],{
   radius:7,fillColor:tempColor(p.t2m),
   fillOpacity:0.85,color:'#333'
  }).bindPopup(`<b>${p.name}</b><br>Lämpö: ${p.t2m} °C<br>Tuuli: ${p.ws} m/s`)
    .addTo(map);
 });
});

fetch('http://localhost:8002/api/forecast')
.then(r=>r.json())
.then(fc=>{
 console.log('FC FEATURES:',fc.features.length);
 fc.features.forEach((f,i)=>{
  if(i%6!==0)return;
  var c=f.geometry.coordinates;
  var t=f.properties.t2m;
  L.circleMarker([c[1],c[0]],{
   radius:4,fillColor:tempColor(t),
   fillOpacity:0.4,color:'none'
  }).addTo(map);
 });
});
</script>
</body>
</html>
